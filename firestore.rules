rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow logged-in users to read from any collection by default.
    // This covers public collections like 'users', 'videos', 'surveys', etc.
    match /{document=**} {
      allow read: if request.auth != null;
    }

    // --- Admin Verification Rules ---

    // Allow any authenticated user to query the adminCodes collection.
    // The security logic is handled in the application code (checking email and code).
    match /adminCodes/{code} {
      allow list: if request.auth != null;
      // Disallow direct reads of individual code documents for extra security.
      allow get, write: if false;
    }

    // Allow a user to write to their OWN document in the 'admins' collection.
    // This lets a user be promoted to admin status but stops them from changing others.
    match /admins/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // --- General Config ---
    // Logged-in users can read config, but not write.
    match /config/{document=**} {
      allow read: if request.auth != null;
      allow write: if false; // Only server-side or console changes allowed
    }
  }
}
